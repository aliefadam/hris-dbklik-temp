<div class="overlay bg-[rgba(0,0,0,0.7)] fixed top-0 left-0 z-20 w-full h-screen hidden justify-center items-center">
    <div class="w-[50%] animate__animated animate__fadeInDown container-overlay">
        <div class="bg-dbklik px-4 py-3 flex justify-between items-center rounded-tl-lg rounded-tr-lg">
            <h1 class="text-yellow-dbklik text-lg font-semibold">Detail Perizinan</h1>
            <i
                class="bi bi-x-lg text-yellow-dbklik cursor-pointer flex hover:bg-slate-300 hover:text-dbklik duration-200 rounded-full p-3 font-semibold btn-close-overlay"></i>
        </div>
        <div class="bg-gray-100 p-5 rounded-bl-lg rounded-br-lg">
            <div class="flex gap-5">
                <div class="flex-[1] flex flex-col gap-5">
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Nama</span>
                        <span class="overlay-nama text-black drop-shadow-md text-lg leading-none font-medium">Alief
                            Sya'arah
                            Adam</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Izin</span>
                        <span
                            class="overlay-izin text-black drop-shadow-md text-lg leading-none font-medium">Sakit</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Tanggal Diajukan</span>
                        <span
                            class="overlay-tanggal-diajukan text-black drop-shadow-md text-lg leading-none font-medium">Minggu,
                            4 Maret
                            2024 - 09:00</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Catatan</span>
                        <span class="overlay-catatan text-black drop-shadow-md text-lg leading-none font-medium">Lorem
                            Lorem, ipsum dolor sit amet consectetur adipisicing elit. Asperiores, nam.</span>
                    </div>
                </div>
                <div class="flex-[1] flex flex-col gap-5">
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Tanggal Izin</span>
                        <span class="overlay-tanggal-izin text-black drop-shadow-md text-lg leading-none font-medium">5
                            - 6 Maret
                            2024</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">File Pendukung</span>
                        <span
                            class="overlay-file-pendukung text-black drop-shadow-md text-lg leading-none font-medium">surat-dokter.pdf</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Status</span>
                        <span
                            class="overlay-status drop-shadow-md text-lg leading-none font-medium cursor-pointer capitalize"><i
                                class="bi bi-check-circle-fill"></i> Disetujui</span>
                    </div>
                    <div class="flex flex-col gap-1 kolom-feedback">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div
    class="overlay-head bg-[rgba(0,0,0,0.7)] fixed top-0 left-0 z-20 w-full h-screen hidden justify-center items-center">
    <div class="w-[50%] animate__animated animate__fadeInDown container-overlay-head">
        <div class="bg-dbklik px-4 py-3 flex justify-between items-center rounded-tl-lg rounded-tr-lg">
            <h1 class="text-yellow-dbklik text-lg font-semibold">Detail Perizinan</h1>
            <i
                class="bi bi-x-lg text-yellow-dbklik cursor-pointer flex hover:bg-slate-300 hover:text-dbklik duration-200 rounded-full p-3 font-semibold btn-close-overlay-head"></i>
        </div>
        <div class="bg-gray-100 p-5 rounded-bl-lg rounded-br-lg">
            <div class="flex gap-5">
                <div class="flex-[1] flex flex-col gap-5">
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Nama</span>
                        <span class="overlay-head-nama text-black drop-shadow-md text-lg leading-none font-medium">Alief
                            Sya'arah
                            Adam</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Izin</span>
                        <span
                            class="overlay-head-izin text-black drop-shadow-md text-lg leading-none font-medium">Sakit</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Tanggal Diajukan</span>
                        <span
                            class="overlay-head-tanggal-diajukan text-black drop-shadow-md text-lg leading-none font-medium">Minggu,
                            4 Maret
                            2024 - 09:00</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Catatan</span>
                        <span
                            class="overlay-head-catatan text-black drop-shadow-md text-lg leading-none font-medium">Lorem
                            Lorem, ipsum dolor sit amet consectetur adipisicing elit. Asperiores, nam.</span>
                    </div>
                </div>
                <div class="flex-[1] flex flex-col gap-5">
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Tanggal Izin</span>
                        <span
                            class="overlay-head-tanggal-izin text-black drop-shadow-md text-lg leading-none font-medium">5
                            - 6 Maret
                            2024</span>
                    </div>

                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">File Pendukung</span>
                        <span
                            class="overlay-head-file-pendukung text-black drop-shadow-md text-lg leading-none font-medium">surat-dokter.pdf</span>
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-dbklik text-[14px]">Status</span>
                        <span class="overlay-head-status drop-shadow-md text-lg leading-none font-medium capitalize"><i
                                class="bi bi-check-circle-fill"></i> Disetujui</span>
                    </div>
                    <div class="flex flex-col gap-1 kolom-feedback"></div>
                </div>
            </div>
            <form action="/balas-perizinan/" class="form-balasan" method="post">
                @csrf
                <div class="mt-5 kolom-balasan"></div>
            </form>
        </div>
    </div>
</div>

<div
    class="overlay-resign bg-[rgba(0,0,0,0.7)] fixed top-0 left-0 z-20 w-full h-screen hidden justify-center items-center">
    <div class="w-[40%] animate__animated animate__fadeInDown container-overlay-resign">
        <div class="bg-dbklik px-4 py-3 flex justify-between items-center rounded-tl-lg rounded-tr-lg">
            <h1 class="text-yellow-dbklik text-lg font-semibold">Resign</h1>
            <i
                class="bi bi-x-lg text-yellow-dbklik cursor-pointer flex hover:bg-slate-300 hover:text-dbklik duration-200 rounded-full p-3 font-semibold btn-close-overlay-resign"></i>
        </div>
        <div class="bg-gray-100 p-5 rounded-bl-lg rounded-br-lg">
            <form action="/hr/resign" method="post" enctype="multipart/form-data" class="w-full flex flex-col gap-3">
                @csrf
                <input type="hidden" name="karyawan_id"
                    value="{{ isset($data_karyawan->id) ? $data_karyawan->id : '' }}">
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="tanggal_resign" class="text-dbklik">Tanggal Resign</label>
                    <input type="date" name="tanggal_resign" id="tanggal_resign" class="bg-transparent outline-none">
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="catatan" class="text-dbklik">Catatan</label>
                    <textarea name="catatan" id="catatan" class="bg-transparent outline-none resize-none h-[150px]"></textarea>
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="file_surat" class="text-dbklik">File Surat</label>
                    <input type="file" name="file_surat" id="file_surat" class="outline-none">
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="bg-yellow-dbklik px-10 py-2 rounded-lg font-medium">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>

<?php
use Carbon\Carbon;
?>

<div
    class="overlay-kontrak bg-[rgba(0,0,0,0.7)] fixed top-0 left-0 z-20 w-full h-screen hidden justify-center items-center">
    <div class="w-[40%] animate__animated animate__fadeInDown container-overlay-kontrak">
        <div class="bg-dbklik px-4 py-3 flex justify-between items-center rounded-tl-lg rounded-tr-lg">
            <h1 class="text-yellow-dbklik text-lg font-semibold">Perpanjang Kontrak</h1>
            <i
                class="bi bi-x-lg text-yellow-dbklik cursor-pointer flex hover:bg-slate-300 hover:text-dbklik duration-200 rounded-full p-3 font-semibold btn-close-overlay-kontrak"></i>
        </div>
        <div class="bg-gray-100 p-5 rounded-bl-lg rounded-br-lg">
            <form action="/hr/updateKontrak" method="post" class="w-full flex flex-col gap-3">
                @csrf
                <input type="hidden" name="karyawan_id"
                    value="{{ isset($data_karyawan->id) ? $data_karyawan->id : '' }}">
                <div class="flex flex-col gap-1 leading-none">
                    <span class="text-dbklik text-sm">Tanggal Mulai Kontrak</span>
                    <span
                        class="tanggal_mulai_kontrak text-xl">{{ isset($data_karyawan->tanggal_masuk_kerja) ? Carbon::parse($data_karyawan->tanggal_masuk_kerja)->formatLocalized('%d %B %Y') : '' }}</span>
                </div>
                <div class="flex flex-col gap-1 leading-none">
                    <span class="text-dbklik text-sm">Tanggal Akhir Kontrak</span>
                    <span id="tanggal_akhir_kontrak"
                        class="tanggal_akhir_kontrak text-xl">{{ isset($data_karyawan->berakhir_kerja) ? Carbon::parse($data_karyawan->berakhir_kerja)->formatLocalized('%d %B %Y') : '' }}</span>
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="durasi" class="text-dbklik">Durasi</label>
                    <select name="durasi" id="durasi" class="outline-none bg-transparent">
                        <option value=3>3 Bulan</option>
                        <option value=6>6 Bulan</option>
                        <option value=12>12 Bulan</option>
                    </select>
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="file_surat" class="text-dbklik">File Surat</label>
                    <input type="file" name="file_surat" id="file_surat" class="outline-none">
                </div>
                <div class="flex justify-end">
                    <button type="submit"
                        class="bg-yellow-dbklik px-10 py-2 rounded-lg font-medium">Perpanjang</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div
    class="overlay-catatan bg-[rgba(0,0,0,0.7)] fixed top-0 left-0 z-20 w-full h-screen hidden justify-center items-center">
    <div class="w-[40%] animate__animated animate__fadeInDown container-overlay-catatan">
        <div class="bg-dbklik px-4 py-3 flex justify-between items-center rounded-tl-lg rounded-tr-lg">
            <h1 class="text-yellow-dbklik text-lg font-semibold">Edit Catatan</h1>
            <i
                class="bi bi-x-lg text-yellow-dbklik cursor-pointer flex hover:bg-slate-300 hover:text-dbklik duration-200 rounded-full p-3 font-semibold btn-close-overlay-catatan"></i>
        </div>
        <div class="bg-gray-100 p-5 rounded-bl-lg rounded-br-lg">
            <form action="/hr/updateCatatan/" method="post" class="w-full flex flex-col gap-3">
                @csrf
                <input type="hidden" name="karyawan_id"
                    value="{{ isset($data_karyawan->id) ? $data_karyawan->id : '' }}">
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="catatan" class="text-dbklik">Catatan</label>
                    <textarea name="catatan" id="catatan" class="bg-transparent outline-none resize-none h-[150px]">{{ isset($data_karyawan->catatan) ? $data_karyawan->catatan : '' }}</textarea>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="bg-yellow-dbklik px-10 py-2 rounded-lg font-medium">Simpan</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div
    class="overlay-mutasi bg-[rgba(0,0,0,0.7)] fixed top-0 left-0 z-20 w-full h-screen hidden justify-center items-center">
    <div class="w-[40%] animate__animated animate__fadeInDown container-overlay-mutasi">
        <div class="bg-dbklik px-4 py-3 flex justify-between items-center rounded-tl-lg rounded-tr-lg">
            <h1 class="text-yellow-dbklik text-lg font-semibold">Tambah Mutasi</h1>
            <i
                class="bi bi-x-lg text-yellow-dbklik cursor-pointer flex hover:bg-slate-300 hover:text-dbklik duration-200 rounded-full p-3 font-semibold btn-close-overlay-mutasi"></i>
        </div>
        <div class="bg-gray-100 p-5 rounded-bl-lg rounded-br-lg">
            <form action="/hr/tambahMutasi" class="w-full flex flex-col gap-3" method="post" enctype="multipart/form-data">
                @csrf                
                <input type="hidden" id="karyawan_id" name="karyawan_id"
                    value="{{ isset($karyawan->id) ? $karyawan->id : '' }}">
                    <input type="hidden" name="tujuanString" value="">
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="jenis_mutasi" class="text-dbklik">Jenis Mutasi</label>
                    <select name="jenis_mutasi" id="jenis_mutasi" class="outline-none bg-transparent">
                        <option value="pindah-jabatan">Pindah Jabatan</option>
                        <option value="pindah-cabang">Pindah Cabang</option>
                        <option value="pindah-divisi">Pindah Divisi</option>
                        <option value="pindah-sub-divisi">Pindah Sub Divisi</option>
                    </select>
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="awal" class="text-dbklik">Awal </label>
                    <input readonly type="text" name="awal" id="awal" class="outline-none bg-transparent"
                        value={{ isset($karyawan) ? $karyawan->jabatan->nama_jabatan : '' }}>
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="tujuan" class="text-dbklik">Tujuan</label>
                    <select name="tujuan" id="tujuan" class="outline-none bg-transparent">
                        @if (isset($jabatan))
                            @foreach($jabatan as $jabatan)
                                <option value={{$jabatan->id}}>{{ $jabatan->nama_jabatan }}</option>
                            @endforeach
                        @endif
                    </select>
                </div>
                <div class="flex flex-col gap-1 border border-dbklik p-3 rounded-md">
                    <label for="surat_mutasi" class="text-dbklik">Surat Mutasi</label>
                    <input required type="file" name="surat_mutasi" id="surat_mutasi" class="outline-none">
                </div>
                <div class="flex justify-end">
                    <button class="bg-yellow-dbklik px-10 py-2 rounded-lg font-medium">Tambah</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>

    function setTujuanString(select) {
        const opt = select.find("option:selected").text();
        $("input[name=tujuanString]").val(opt);
    }

    $("select[name=tujuan]").on("change", function() {
        const opt = $(this).find("option:selected").text();
        $("input[name=tujuanString]").val(opt);
        // setTujuanString($(this));
    })

    $("select[name=jenis_mutasi]").on("change", function() {
        // setTujuanString($("select[name=tujuan]"));
        

        $.ajaxSetup({
            headers: {
                "X-CSRF-TOKEN": $("meta[name=csrf-token]").attr("content"),
            }
        })
        $.ajax({
            url: "/hr/mutasi",
            type: "POST",
            data: {
                jenis_mutasi: $(this).val(),
                karyawan_id: $("#karyawan_id").val(),
            },beforeSend: function() {
                    $("#awal").val("Loading..");
                    $("#tujuan").html("<option value=''>Loading..</option>");
                },
            success: function(res) {
                $("select#tujuan").html("");
                $("input#awal").val(res.awal);
                if(res.jenis_mutasi == "pindah-cabang") {
                    $.each(res.akhir, function(i, opt) {
                        $("select#tujuan").append(`<option value="${opt.id}">${opt.nama_cabang}</option>`);
                    });

                    $("input[name=tujuanString]").val(res.akhir[0].nama_cabang);
                } else if(res.jenis_mutasi == "pindah-divisi") {
                    $.each(res.akhir, function(i, opt) {
                        $("select#tujuan").append(`<option value="${opt.id}">${opt.nama_divisi}</option>`);
                    });
                    $("input[name=tujuanString]").val(res.akhir[0].nama_divisi);
                } else if(res.jenis_mutasi == "pindah-sub-divisi") {
                    $.each(res.akhir, function(i, opt) {
                        $("select#tujuan").append(`<option value="${opt.id}">${opt.nama_sub_divisi}</option>`);
                    });
                    $("input[name=tujuanString]").val(res.akhir[0].nama_sub_divisi);
                }else if(res.jenis_mutasi == "pindah-jabatan") {
                    $.each(res.akhir, function(i, opt) {
                        $("select#tujuan").append(`<option value="${opt.id}">${opt.nama_jabatan}</option>`);
                    });
                    $("input[name=tujuanString]").val(res.akhir[0].nama_jabatan);
                }
            },
            error: function(e) {
                console.log(e);
            }
        })

        
    });
    // $("select[name=jenis_mutasi]").on("change", function() {
    //     $.ajaxSetup({
    //         headers: {
    //             "X-CSRF-TOKEN": $("meta[name=csrf-token]").attr("content"),
    //         }
    //     })
    //     $.ajax({
    //         url: "/hr/mutasi",
    //         type: "POST",
    //         data: {
    //             karyawanId: $("#karyawan_id"),
    //         },
    //         success: function(response) {
    //             console.log(response);
    //         },
    //         error: function(e) {
                
    //         }
    //     });
        // $.ajax({
        //         type: "POST",
        //         url: "/hr/mutasi", 
        //         data: {
        //             jenisMutasi: $(this).val(),
        //             id: $data_karyawan->id
        //         },
        //         beforeSend: function() {
        //             $("#awal").val("Loading..");
        //             $("#tujuan").html("<option value=''>Loading..</option>");
        //         },
        //         success: function(response) {
        //             $("#awal").val(response.awal);
        //             $("#tujuan").empty();
        //             $.each(response.akhir, function(index, option) {
        //                 console.log(option); // Debugging: Log each option to check its structure
        //                 $("#tujuan").append('<option value="' + option.value + '">' + option.text + '</option>');
        //             });
        //         },

        //     });
    // });
</script>
